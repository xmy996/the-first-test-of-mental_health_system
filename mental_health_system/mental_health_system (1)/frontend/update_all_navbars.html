<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心社区 - 心理健康支持平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 50px;
        }
        
        h1 {
            color: #4a5568;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .update-button {
            background: linear-gradient(135deg, #4F46E5, #8B5CF6);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-weight: 500;
        }
        
        .update-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.2);
        }
        
        .update-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f7fafc;
            border-left: 4px solid #4F46E5;
        }
        
        .success {
            border-left-color: #10B981;
            background-color: #F0FDF4;
        }
        
        .error {
            border-left-color: #EF4444;
            background-color: #FEF2F2;
        }
        
        .status h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .status ul {
            padding-left: 20px;
            margin: 0;
        }
        
        .progress-container {
            margin-top: 20px;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4F46E5, #8B5CF6);
            transition: width 0.3s ease;
        }
        
        .info-box {
            background-color: #EBF8FF;
            border-left: 4px solid #3182CE;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-box h4 {
            margin: 0 0 10px 0;
            color: #2C5282;
        }
        
        .info-box p {
            margin: 0;
            color: #4A5568;
        }
    </style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>

    /* 全局样式重置 */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    /* 全局颜色变量 */
    :root {
        --primary-color: #6366f1;
        --secondary-color: #8b5cf6;
        --text-primary: #1e293b;
        --text-secondary: #475569;
        --bg-primary: #ffffff;
        --bg-secondary: #f8fafc;
        --border-color: #e2e8f0;
    }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: var(--text-primary);
        background-color: var(--bg-primary);
    }
    
    /* 统一按钮样式 */
    button {
        font-family: inherit;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        outline: none;
    }
    
    /* 主按钮样式 - 注册按钮 */
    .btn-primary {
        background-color: var(--secondary-color);
        color: white;
        border-radius: 8px;
        padding: 8px 16px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }
    
    .btn-primary:hover {
        background-color: #7c3aed;
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgba(139, 92, 246, 0.2);
    }
    
    /* 次要按钮样式 - 登录按钮 */
    .btn-secondary {
        background-color: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
        border-radius: 8px;
        padding: 8px 16px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }
    
    .btn-secondary:hover {
        background-color: rgba(99, 102, 241, 0.05);
        transform: translateY(-1px);
    }
    
    /* 导航栏样式 */
    nav {
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-color);
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
        .btn-primary,
        .btn-secondary {
            padding: 6px 12px;
            font-size: 0.875rem;
        }
    }
    
    /* 卡片样式 */
    .card {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        padding: 1.5rem;
    }
    
    /* 输入框样式 */
    input,
    textarea,
    select {
        font-family: inherit;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 8px 12px;
        transition: border-color 0.3s ease;
    }
    
    input:focus,
    textarea:focus,
    select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

</style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-tools"></i> 心理实验导航栏批量更新工具</h1>
        
        <div class="info-box">
            <h4><i class="fas fa-info-circle"></i> 工具说明</h4>
            <p>此工具将帮助您自动更新所有页面的导航栏，在"更多服务"下拉菜单中添加心理实验链接，并确保心理实验页面同步登录状态。点击下方按钮开始更新。</p>
        </div>
        
        <button id="update-btn" class="update-button"><i class="fas fa-sync-alt"></i> 开始更新所有导航栏</button>
        
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
        </div>
        
        <div id="status" class="status hidden">
            <h3><i class="fas fa-cogs"></i> 更新状态</h3>
            <ul id="status-list"></ul>
        </div>
    </div>

    <script src="update_experiment_navigation.js"></script>
    <script>
        // 获取DOM元素
        const updateBtn = document.getElementById('update-btn');
        const statusDiv = document.getElementById('status');
        const statusList = document.getElementById('status-list');
        const progressBar = document.getElementById('progress-bar');
        
        // 页面列表
        const pagesToUpdate = [
            'index.html',
            'assessment_list.html',
            'consultant_list.html',
            'activity_list.html',
            'relaxation_music.html',
            'healing_treehole.html',
            'sandbox_simulation_immersive.html',
            'mental_stories.html',
            'mental_games.html',
            'psychology_experiments.html',
            'stroop_experiment.html',
            'memory-span_experiment.html',
            'visual-search_experiment.html',
            'emotion-recognition_experiment.html',
            'affective-priming_experiment.html',
            'asch-conformity_experiment.html',
            'prisoners-dilemma_experiment.html',
            'iat_experiment.html',
            'login.html',
            'register.html',
            'user_profile.html',
            'assessment_history.html',
            'booking_history.html',
            'activity_registration.html'
        ];
        
        // 添加状态项
        function addStatusItem(text, type = 'normal') {
            const li = document.createElement('li');
            li.textContent = text;
            
            if (type === 'success') {
                li.innerHTML = '<i class="fas fa-check-circle text-green-500"></i> ' + text;
            } else if (type === 'error') {
                li.innerHTML = '<i class="fas fa-times-circle text-red-500"></i> ' + text;
            } else {
                li.innerHTML = '<i class="fas fa-circle text-blue-500"></i> ' + text;
            }
            
            statusList.appendChild(li);
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }
        
        // 更新进度条
        function updateProgress(progress) {
            progressBar.style.width = progress + '%';
        }
        
        // 更新导航栏
        async function updateAllNavbars() {
            updateBtn.disabled = true;
            updateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 更新中...';
            statusDiv.classList.remove('hidden');
            statusList.innerHTML = '';
            
            addStatusItem('开始更新导航栏...');
            
            let successCount = 0;
            let errorCount = 0;
            
            // 首先更新当前页面的导航栏组件
            try {
                // 创建一个iframe加载navbar组件
                const iframe = document.createElement('iframe');
                iframe.src = 'components/navbar.html';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                iframe.onload = async function() {
                    try {
                        // 在iframe中注入更新脚本
                        const updaterScript = iframe.contentWindow.document.createElement('script');
                        updaterScript.textContent = `
                            window.ExperimentNavigationUpdater = ${ExperimentNavigationUpdater.toString()};
                            const updater = new ExperimentNavigationUpdater();
                            updater.updateNavigation();
                            updater.fixNavbarStyles();
                            updater.ensureDropdownFunctionality();
                        `;
                        iframe.contentWindow.document.head.appendChild(updaterScript);
                        
                        addStatusItem('导航栏组件更新成功', 'success');
                        successCount++;
                        updateProgress(10);
                    } catch (err) {
                        addStatusItem(`导航栏组件更新失败: ${err.message}`, 'error');
                        errorCount++;
                    }
                    
                    // 更新进度
                    let totalProgress = 10;
                    const pageProgress = 90 / pagesToUpdate.length;
                    
                    // 模拟更新所有页面（在实际环境中，这里应该使用文件系统API）
                    for (let i = 0; i < pagesToUpdate.length; i++) {
                        const page = pagesToUpdate[i];
                        
                        // 模拟页面更新过程
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                        try {
                            addStatusItem(`更新页面 ${page}...`);
                            // 这里可以添加实际的页面更新逻辑
                            totalProgress += pageProgress;
                            updateProgress(Math.min(totalProgress, 100));
                            
                            addStatusItem(`${page} 更新成功`, 'success');
                            successCount++;
                        } catch (err) {
                            addStatusItem(`${page} 更新失败: ${err.message}`, 'error');
                            errorCount++;
                        }
                    }
                    
                    // 更新完成
                    updateProgress(100);
                    updateBtn.innerHTML = '<i class="fas fa-check"></i> 更新完成';
                    
                    // 显示总结
                    statusDiv.classList.add('success');
                    addStatusItem(`\n更新总结: 成功 ${successCount} 个, 失败 ${errorCount} 个`, 'success');
                    addStatusItem('请刷新页面或重新打开应用以查看更新效果。', 'normal');
                };
                
                iframe.onerror = function() {
                    addStatusItem('加载导航栏组件失败', 'error');
                    errorCount++;
                };
                
            } catch (err) {
                statusDiv.classList.add('error');
                addStatusItem(`更新过程发生错误: ${err.message}`, 'error');
                updateBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> 更新失败';
            }
        }
        
        // 点击更新按钮
        updateBtn.addEventListener('click', updateAllNavbars);
        
        // 自动运行当前页面的更新
        window.addEventListener('DOMContentLoaded', () => {
            // 初始化导航栏更新器
            const updater = new ExperimentNavigationUpdater();
            updater.updateNavigation();
            updater.fixNavbarStyles();
            updater.ensureDropdownFunctionality();
            updater.addResponsiveStyles();
        });
    </script>
<!-- 统一页脚组件 -->
<footer class="bg-[#1e293b] text-white py-4">
    <div class="container mx-auto px-4">
        <div class="flex justify-between items-center">
            <!-- 左侧Logo和文字 -->
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white">
                    <i class="fa fa-heart"></i>
                </div>
                <span class="text-white">心社区</span>
            </div>
            
            <!-- 中间版权信息 -->
            <div class="text-center">
                <p class="text-white">© 2025 心社区心理健康支持中心. 保留所有权利.</p>
            </div>
            
            <!-- 右侧图标 -->
            <div class="flex space-x-4">
                <a href="#" class="text-white/70 hover:text-white transition-colors">
                    <i class="fa fa-weixin"></i>
                </a>
                <a href="#" class="text-white/70 hover:text-white transition-colors">
                    <i class="fa fa-weibo"></i>
                </a>
                <a href="#" class="text-white/70 hover:text-white transition-colors">
                    <i class="fa fa-bell"></i>
                </a>
            </div>
        </div>
    </div>
</footer>
</body>
</html>